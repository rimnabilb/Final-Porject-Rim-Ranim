<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Messages</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #ec8622;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .top-bar {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
      gap: 1rem;
    }
    button {
      padding: 10px 16px;
      background-color: #39d23c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background-color: #46c92c;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2rem;
      background: rgb(255, 219, 162);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #8fd94f;
      color: rgb(42, 21, 68);
    }
    tr:hover {
      background-color: #51507d;
    }
    button.delete-btn {
      padding: 5px 10px;
      background-color: #8fd94f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button.delete-btn:hover {
      background-color: #8fd94f;
    }
    #messagesContainer {
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ðŸŽƒMessages from Contact FormðŸŽƒ</h1>

  <div class="top-bar">
    <button id="deleteAllBtn">ðŸª¦Delete All Messages</button>
  </div>

  <div id="messagesContainer">
    <table id="messagesTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Message</th>
          <th>Date</th>
          <th>Action</th> <!-- For individual delete -->
        </tr>
      </thead>
      <tbody id="messagesBody">
        <tr><td colspan="5" style="text-align:center;">Loading messages...</td></tr>
      </tbody>
    </table>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc, orderBy, query } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    // Firebase config (same as contact page)
    const firebaseConfig = {
  apiKey: "AIzaSyC2Yu9gsCzgLRw8uWzCKR7Ykhf0zOVc5j8",
  authDomain: "final-project-34269.firebaseapp.com",
  projectId: "final-project-34269",
  storageBucket: "final-project-34269.firebasestorage.app",
  messagingSenderId: "191895125625",
  appId: "1:191895125625:web:b70472c9c7e1cdd313dea8",
  measurementId: "G-3ME3MN7719"
};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Load messages
    async function loadMessages() {
      const tbody = document.getElementById("messagesBody");
      tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">Loading messages...</td></tr>`;

      try {
        const q = query(collection(db, "Contacts"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No messages yet.</td></tr>`;
          return;
        }

        let rows = "";
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const date = data.timestamp?.toDate ? new Date(data.timestamp.toDate()).toLocaleString() : "N/A";

          rows += `
            <tr>
              <td>${data.name}</td>
              <td>${data.email}</td>
              <td>${data.message}</td>
              <td>${date}</td>
              <td><button class="delete-btn" data-id="${docSnap.id}">Delete</button></td>
            </tr>
          `;
        });

        tbody.innerHTML = rows;

        // Add click events for individual delete buttons
        document.querySelectorAll(".delete-btn").forEach(button => {
          button.addEventListener("click", async (e) => {
            const docId = e.target.getAttribute("data-id");
            const confirmDelete = confirm("Are you sure you want to delete this message?");
            if (!confirmDelete) return;

            try {
              await deleteDoc(doc(db, "Contacts", docId));
              alert("Message deleted successfully.");
              loadMessages(); // reload table
            } catch (error) {
              console.error("Error deleting message:", error);
              alert("Failed to delete message. Check console.");
            }
          });
        });

      } catch (error) {
        console.error("Error loading messages: ", error);
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:red;">Error loading messages.</td></tr>`;
      }
    }

    // Delete all messages
    async function deleteAllMessages() {
      const confirmDelete = confirm("Are you sure you want to delete ALL messages?");
      if (!confirmDelete) return;

      try {
        const querySnapshot = await getDocs(collection(db, "Contacts"));
        const deletePromises = querySnapshot.docs.map((docSnap) => deleteDoc(doc(db, "contacts", docSnap.id)));
        await Promise.all(deletePromises);

        alert("All messages deleted successfully.");
        loadMessages();
      } catch (error) {
        console.error("Error deleting messages:", error);
        alert("Failed to delete messages. Check console for details.");
      }
    }

    document.getElementById("deleteAllBtn").addEventListener("click", deleteAllMessages);

    loadMessages();
  </script>
</body>
</html>
